data font {
	align 256
font_charset_bank1:
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x1C 0x1C 0x1C 0x1C 0x08 0x00 0x08 0x1C
	0x66 0x22 0x22 0x44 0x00 0x00 0x00 0x00
	0x4C 0x5E 0x74 0x66 0x3E 0x3B 0xF0 0x08
	0x04 0x04 0x07 0xE6 0x2C 0x5C 0x84 0xE4
	0x20 0x70 0x72 0x06 0x0C 0x38 0xE3 0x03
	0x70 0x58 0x68 0x3A 0x32 0x7E 0x7E 0x02
	0x18 0x1C 0x0C 0x18 0x00 0x00 0x00 0x00
	0x00 0x3E 0x60 0x40 0x60 0x20 0x38 0x00
	0x00 0x18 0x0C 0x04 0x0C 0x18 0x30 0x20
	0x00 0x42 0x24 0x00 0xC3 0x00 0x24 0x42
	0x00 0x10 0x1E 0x38 0x70 0x10 0x10 0x00
	0x00 0x00 0x18 0x38 0x08 0x18 0x10 0x00
	0x00 0x00 0x00 0x0C 0x78 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x38 0x38 0x38 0x00
	0x00 0x0E 0x18 0x30 0x60 0x40 0x00 0x00
	0xBC 0xE6 0xF2 0x9A 0x8E 0xC7 0x7D 0x00
	0x08 0x38 0x28 0x08 0x08 0x08 0x08 0x08
	0x00 0x3C 0x66 0x0C 0x38 0x78 0x0F 0x00
	0x00 0x3E 0x22 0x06 0x1E 0x02 0x3E 0x00
	0x00 0x20 0x26 0x64 0x7E 0x4C 0x08 0x00
	0x00 0x38 0x20 0x3C 0x34 0x04 0x0C 0x38
	0x00 0x0C 0x18 0x3E 0x22 0x3E 0x00 0x00
	0x3E 0x22 0x02 0x0E 0x1C 0x04 0x0C 0x08
	0x1C 0x7C 0x4C 0x7E 0x1A 0x32 0x2E 0x38
	0x38 0xE8 0x98 0xFC 0x04 0x06 0x02 0x00
	0x00 0x00 0x18 0x00 0x00 0x18 0x00 0x00
	0x18 0x10 0x00 0x04 0x1C 0x04 0x0C 0x08
	0x00 0x06 0x0C 0x38 0x60 0x38 0x0E 0x00
	0x00 0x00 0x7E 0x00 0x3E 0x00 0x00 0x00
	0x00 0x60 0x30 0x1C 0x0C 0x38 0x60 0x00
	0x00 0x3E 0x62 0x06 0x0C 0x00 0x18 0x18
font_charset_bank2:
	0x3E 0x63 0xCD 0x9D 0xFD 0x31 0x03 0x06
	0x1C 0x14 0x36 0x22 0x6F 0x59 0x41 0x41
	0x7C 0x47 0x41 0x67 0x7C 0x44 0xC4 0xFC
	0x0E 0x38 0x60 0x40 0x40 0x60 0x3E 0x00
	0x00 0x78 0x4C 0x66 0x22 0x22 0x6E 0x78
	0x70 0x5C 0xC0 0xF0 0x98 0x80 0xF0 0x3C
	0x0C 0xF8 0x80 0x88 0xF8 0x80 0xC0 0x60
	0x7E 0x43 0xC0 0x80 0x86 0x86 0xEF 0x39
	0x66 0x66 0x7A 0x41 0x7A 0x66 0x66 0x00
	0x3E 0x6B 0x08 0x08 0x08 0x08 0x78 0x0F
	0x7C 0x08 0x08 0x0C 0x04 0x4C 0x78 0x20
	0x02 0x62 0x46 0x7C 0x58 0x4C 0xC6 0x80
	0x40 0x40 0x40 0x40 0xC0 0x80 0x9E 0xF0
	0x00 0x46 0x66 0x7F 0x59 0x4B 0x43 0x41
	0x02 0x62 0x72 0x5A 0x4A 0x4E 0x46 0x40
	0x1C 0x74 0x46 0xC2 0xC2 0x42 0x7E 0x0C
	0x30 0x7C 0x46 0x46 0xFC 0x80 0x80 0x80
	0x1C 0x34 0x64 0x44 0x4C 0x6E 0x3A 0x02
	0x3E 0x62 0x46 0x5C 0x70 0x5C 0xC6 0x82
	0x3E 0x60 0x60 0x38 0x0C 0x04 0x7C 0x60
	0xFF 0x99 0x18 0x18 0x18 0x18 0x18 0x3C
	0x80 0x8C 0x8C 0x8C 0xCC 0x4E 0x7A 0x02
	0x82 0xC6 0x64 0x24 0x3C 0x18 0x18 0x00
	0x00 0x82 0xB6 0xB4 0xFC 0x4C 0x44 0x00
	0xC0 0xF7 0x1C 0x10 0x10 0x38 0x6E 0x02
	0x60 0x22 0x36 0x1C 0x0C 0x08 0x18 0x10
	0x3E 0x26 0x0C 0x78 0x1F 0x30 0x20 0x3E
	0x3C 0x20 0x20 0x20 0x20 0x20 0x3E 0x00
	0x18 0x3C 0x24 0x64 0xFC 0xBE 0xAA 0x38
	0x78 0x08 0x08 0x0C 0x04 0x04 0x3C 0x00
	0x18 0x18 0x3C 0x64 0xC6 0x82 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0xC3 0x7E 0x00
font_charset_bank3:
	0x00 0x66 0x6F 0xFF 0xFF 0x7F 0x3E 0x1C
	0x18 0x18 0x18 0x1F 0x1F 0x18 0x18 0x18
	0x03 0x03 0x03 0x03 0x03 0x03 0x03 0x03
	0x18 0x18 0x18 0xF8 0xF8 0x00 0x00 0x00
	0x18 0x18 0x18 0xF8 0xF8 0x18 0x18 0x18
	0x00 0x00 0x00 0xF8 0xF8 0x18 0x18 0x18
	0x03 0x06 0x0C 0x18 0x10 0x30 0x60 0xC0
	0xC0 0x40 0x60 0x30 0x18 0x0E 0x03 0x01
	0x01 0x03 0x07 0x0F 0x1F 0x3F 0x7F 0xFF
	0x00 0x00 0x00 0x00 0x0F 0x0F 0x0F 0x0F
	0x80 0xC0 0xF0 0xF0 0xFC 0xFE 0xFF 0xFF
	0x0F 0x0F 0x0F 0x0F 0x00 0x00 0x00 0x00
	0xF0 0xF0 0xF0 0xF0 0x00 0x00 0x00 0x00
	0xFF 0xFF 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0xFF 0xFF
	0x00 0x00 0x00 0x00 0xF0 0xF0 0xF0 0xF0
	0x3E 0x41 0x94 0x63 0x1C 0x6B 0x02 0x3E
	0x00 0x00 0x00 0x1F 0x1F 0x18 0x18 0x18
	0x00 0x00 0x00 0xFF 0xFF 0x00 0x00 0x00
	0x18 0x18 0x18 0xFF 0xFF 0x18 0x18 0x18
	0x00 0x3C 0x7E 0x7E 0x7E 0x7E 0x3C 0x00
	0x00 0x00 0x00 0x00 0xFF 0xFF 0xFF 0xFF
	0xC0 0xC0 0xC0 0xC0 0xC0 0xC0 0xC0 0xC0
	0x00 0x00 0x00 0xFF 0xFF 0x18 0x18 0x18
	0x18 0x18 0x18 0xFF 0xFF 0x00 0x00 0x00
	0xF0 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0 0xF0
	0x18 0x18 0x18 0x1F 0x1F 0x00 0x00 0x00
	0x8F 0xAA 0xDA 0x00 0x76 0x41 0x66 0x46
	0x08 0x1C 0x3E 0x72 0x10 0x10 0x10 0x10
	0x10 0x10 0x10 0x10 0x72 0x36 0x1C 0x00
	0x00 0x40 0xC0 0x9F 0xF0 0x60 0x30 0x00
	0x00 0x04 0x06 0x3F 0xE3 0x82 0x06 0x00
font_charset_bank4:
	0x10 0x38 0x3C 0x7E 0xFF 0xFE 0x3C 0x18
	0x00 0x3C 0x66 0xCE 0x1A 0x36 0x3F 0x01
	0xC0 0x40 0x60 0x3C 0x76 0x42 0x46 0x7C
	0x00 0x00 0x7E 0xC2 0x80 0xC0 0x6E 0x3A
	0x00 0x04 0x04 0x1C 0x36 0x26 0x37 0x1C
	0x00 0x7E 0x42 0xC6 0xFC 0xC0 0x60 0x3E
	0x1C 0x34 0x20 0xE0 0x7E 0x20 0x20 0x20
	0x04 0x3E 0x66 0x4E 0x7A 0x06 0x04 0x7C
	0x20 0x20 0x20 0x7E 0x62 0xC2 0xC3 0x41
	0x00 0x18 0x18 0x00 0x38 0x18 0x18 0x3C
	0x10 0x00 0x10 0x18 0x08 0x48 0x78 0x00
	0x40 0x60 0x3C 0x2C 0x78 0x7C 0xC0 0x80
	0x10 0x10 0x10 0x10 0x10 0x10 0x10 0x10
	0x00 0x00 0xFE 0xB3 0x91 0x99 0x80 0x00
	0x00 0x00 0x20 0x3C 0x64 0x64 0x46 0x00
	0x00 0x00 0x00 0x1E 0x32 0x66 0x7C 0x00
	0x00 0x18 0x3E 0x22 0x62 0x7E 0x40 0x40
	0x00 0x00 0x38 0x68 0x7C 0x04 0x06 0x00
	0x00 0x20 0x3E 0x22 0x20 0x60 0x40 0x00
	0x00 0x00 0x3E 0x38 0x0C 0x04 0x3C 0x00
	0x00 0x10 0x10 0x7C 0x10 0x10 0x0C 0x00
	0x00 0x00 0x42 0x46 0x4E 0x7A 0x03 0x00
	0x00 0x00 0x62 0x36 0x14 0x1C 0x08 0x00
	0x00 0x00 0xD0 0x72 0x7E 0x4C 0x0C 0x00
	0x00 0x00 0xE0 0x3E 0x18 0x38 0xEE 0x00
	0x00 0x4C 0x4C 0x7C 0x0C 0x08 0x78 0x30
	0x10 0x00 0x7C 0xDC 0x30 0x60 0x7E 0x00
	0x3C 0x6A 0x3C 0xC3 0xAD 0x7E 0x18 0x3C
	0x18 0x18 0x18 0x18 0x18 0x18 0x18 0x18
	0x7C 0x40 0x78 0xCC 0x84 0x06 0x02 0x02
	0x08 0x08 0x18 0x38 0x78 0x38 0x18 0x08
	0x30 0x38 0x3C 0x3E 0x3C 0x38 0x20 0x00
}

var atari_charset_bank1 = 0xE000
var atari_charset_bank2 = 0xE100
var atari_charset_bank3 = 0xE200
var atari_charset_bank4 = 0xE300

inline push_ax {
	a!!
	a=x
	a!!
}

inline pop_ax {
	a??
	x=a
	a??
}

inline push_axy {
	a!!
	a=x
	a!!
	a=y
	a!!
}

inline pop_axy {
	a??
	y=a
	a??
	x=a
	a??
}

inline reset_frame {
	a=0
	framelo=a
	framehi=a
}

inline inc_frame {
	x=framelo
	x++
	framelo=x
	== {
		x=framehi
		x++
		framehi=x
	}
}

inline copy_charset_to_ram {
	x=0
	{
		PORTB=y=0xFF
		a=font_charset_bank1,x
		PORTB=y=0xFC
		atari_charset_bank1,x=a
		PORTB=y=0xFF
		a=font_charset_bank2,x
		PORTB=y=0xFC
		atari_charset_bank2,x=a
		PORTB=y=0xFF
		a=font_charset_bank3,x
		PORTB=y=0xFC
		atari_charset_bank3,x=a
		PORTB=y=0xFF
		a=font_charset_bank4,x
		PORTB=y=0xFC
		atari_charset_bank4,x=a
		x++
	} !=
}

inline init_atari {
	i+

	a=0
	NMIEN=a
	DMACTL=a
	CHACTL=a
	PRIOR=a

	s=x=0xFF

	copy_charset_to_ram
	PORTB=a=0xFC
}