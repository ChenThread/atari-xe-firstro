data music_ch1_notes {
	align 256
	0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x23
	0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x1F
	0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D
	0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x21 0x23
	0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x23
	0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x1F
	0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D
	0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x21 0x23
	0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x23
	0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x1F
	0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D
	0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x21 0x23
	0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x24 0x23
	0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x21 0x1F
	0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D 0x1D
	0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x1F 0x21 0x23
}

data music_ch2_notes {
	align 256
	0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E
	0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E 0x1E
	0x1A 0x1A 0x1A 0x1A 0x1A 0x1A 0x1A 0x1A 0x1A 0x1A 0x1A 0x1A 0x1A 0x1A 0x1A 0x1A
	0x1C 0x1C 0x1C 0x1C 0x1C 0x1C 0x1C 0x1C 0x1C 0x1C 0x1C 0x1C 0x1C 0x1C 0x1F 0x21

	0x23 0x00 0x00 0x23 0x1F 0x23 0x1F 0x1E 0x1C 0x00 0x00 0x00 0x00 0x1C 0x1F 0x23
	0x28 0x00 0x00 0x28 0x26 0x28 0x26 0x21 0x23 0x00 0x00 0x00 0x00 0x00 0x1E 0x00
	0x1F 0x00 0x00 0x1F 0x1E 0x1F 0x23 0x1E 0x21 0x1C 0x1A 0x21 0x1C 0x1A 0x1E 0x00
	0x1F 0x1C 0x19 0x1F 0x1E 0x1A 0x17 0x1E 0x1E 0x00 0x00 0x1C 0x10 0x1C 0x1F 0x21

	0x17 0x15 0x17 0x1A 0x00 0x00 0x00 0x00 0x17 0x15 0x17 0x1A 0x00 0x1C 0x17 0x15
	0x17 0x15 0x17 0x1A 0x00 0x00 0x00 0x00 0x17 0x15 0x17 0x1E 0x00 0x1E 0x1C 0x00
	0x17 0x15 0x17 0x1A 0x00 0x00 0x00 0x00 0x17 0x15 0x17 0x1A 0x00 0x1C 0x17 0x15
	0x17 0x15 0x17 0x1A 0x00 0x00 0x00 0x00 0x17 0x15 0x17 0x1E 0x00 0x1E 0x1C 0x00

	0x1C 0x00 0x00 0x1C 0x00 0x1A 0x00 0x15 0x1C 0x1C 0x1E 0x1A 0x00 0x00 0x15 0x15
	0x1C 0x1C 0x1E 0x00 0x1A 0x00 0x00 0x15 0x19 0x1A 0x19 0x19 0x00 0x17 0x00 0x00
	0x1E 0x00 0x00 0x1C 0x00 0x00 0x00 0x15 0x1E 0x1F 0x1E 0x1C 0x00 0x00 0x00 0x1A
	0x19 0x1A 0x19 0x19 0x00 0x1A 0x00 0x19 0x00 0x15 0x00 0x00 0x00 0x00 0x00 0x00
}

data music_ch3_notes {
	align 256
	0x1C 0x1C 0x1C 0x1A 0x1A 0x1A 0x1A 0x1A 0x1C 0x1C 0x1C 0x1A 0x1A 0x1A 0x1A 0x1A
	0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19 0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19
	0x17 0x17 0x17 0x15 0x15 0x15 0x15 0x15 0x17 0x17 0x17 0x15 0x15 0x15 0x15 0x15
	0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19 0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19
	0x1C 0x1C 0x1C 0x1A 0x1A 0x1A 0x1A 0x1A 0x1C 0x1C 0x1C 0x1A 0x1A 0x1A 0x1A 0x1A
	0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19 0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19
	0x17 0x17 0x17 0x15 0x15 0x15 0x15 0x15 0x17 0x17 0x17 0x15 0x15 0x15 0x15 0x15
	0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19 0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19
	0x1C 0x1C 0x1C 0x1A 0x1A 0x1A 0x1A 0x1A 0x1C 0x1C 0x1C 0x1A 0x1A 0x1A 0x1A 0x1A
	0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19 0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19
	0x17 0x17 0x17 0x15 0x15 0x15 0x15 0x15 0x17 0x17 0x17 0x15 0x15 0x15 0x15 0x15
	0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19 0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19
	0x1C 0x1C 0x1C 0x1A 0x1A 0x1A 0x1A 0x1A 0x1C 0x1C 0x1C 0x1A 0x1A 0x1A 0x1A 0x1A
	0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19 0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19
	0x17 0x17 0x17 0x15 0x15 0x15 0x15 0x15 0x17 0x17 0x17 0x15 0x15 0x15 0x15 0x15
	0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19 0x1A 0x1A 0x1A 0x19 0x19 0x19 0x19 0x19
}

data music_ch4_notes {
	align 256
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x03 0x03 0x03
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x03 0x03 0x03
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x03 0x03 0x03
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01
	0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x01 0x03 0x01 0x02 0x03 0x03 0x03
}

data music_note_table_64 {
	nocross
	0
	245  231  218  206  194  183  173  163  154  145  137  130  122  115  109  103
	97  92  86  82  77  73  69  65  61  58  54  51  49  46  43  41
	39  36  34  32  31  29  27  26  24  23  22  20  19  18  17  16
	15  14  14  13  12  11  11  10  10  9  9  8  8  7  7
}

data music_note_table_64_4bit {
	nocross
	0
	229  216  204  193  182  172  162  153  144  136  129  121  115  108  102  96
	91  86  81  77  72  68  64  61  57  54  51  48  46  43  40  38
	36  33  31  30  29  27  26  24  23  21  20  19  18  17  16  15
	14  14  13  12  11  11  10  10  9  9  8  8  7  7  6
}

data music_drum_table_per {
	nocross
	0x00 0x01 0x50 0x10 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
	0x00 0x00 0x00 0x00 0x00 0x00 0x00 0x00
}

data music_drum_table_vol {
	nocross
	0x10 0x84 0x87 0x87 0x10 0x10 0x10 0x10
	0x10 0x10 0x10 0x10 0x10 0x10 0x10 0x10
	0x10 0x10 0x10 0x10 0x10 0x10 0x10 0x10
	0x10 0x10 0x10 0x10 0x10 0x10 0x10 0x10
	0x10 0x10 0x10 0x10 0x10 0x10 0x10 0x10
	0x10 0x10 0x10 0x10 0x10 0x10 0x10 0x10
	0x10 0x10 0x10 0x10 0x10 0x10 0x10 0x10
	0x10 0x10 0x10 0x10 0x10 0x10 0x10 0x10
}

func music_kill {
	a=0x10
	AUDC1=a
	AUDC2=a
	AUDC3=a
	AUDC4=a
}

func music_init {
	call music_kill
	AUDCTL=a=0 // 64kHz
}

func music_update_row {
	y=music_rpos
	a=music_ch1_notes,y
	!= {
		a&0x3F
		x=a
		music_per_ch1=a=music_note_table_64_4bit,x
		a=0xC8
		music_vol_ch1=a=0xC8
	}

	a=music_ch2_notes,y
	!= {
		a&0x3F
		x=a
		music_per_ch2=a=music_note_table_64,x
		music_vol_ch2=a=0xE8
	}

	a=music_ch3_notes,y
	!= {
		a&0x3F
		x=a
		music_per_ch3=a=music_note_table_64,x
		music_vol_ch3=a=0xE8
	}

	a=music_ch4_notes,y
	!= {
		== goto music_skip_update_ch4
		x=a
		music_per_ch4=a=music_drum_table_per,x
		music_vol_ch4=a=music_drum_table_vol,x
	}
music_skip_update_ch4:
	music_rpos++
}

func music_update {
	music_rtick--
	!= goto music_skip_update_row
	a=13
	music_rtick=a
	call music_update_row
music_skip_update_row:
	// update volumes
	// ch1
	a=music_vol_ch1
	x=a
	a&0xF
	!= { music_vol_ch1-- }

	AUDC1=x
	AUDF1=a=music_per_ch1

	// ch2
	a=music_vol_ch2
	x=a
	a&0xF
	!= { music_vol_ch2-- }

	AUDC2=x
	AUDF2=a=music_per_ch2

	// ch3
	a=music_vol_ch3
	x=a
	a&0xF
	!= { music_vol_ch3-- }

	AUDC3=x
	AUDF3=a=music_per_ch3

	// ch4
	a=music_vol_ch4
	x=a
	a&0xF
	!= { music_vol_ch4-- }

	AUDC4=x
	AUDF4=a=music_per_ch4
}